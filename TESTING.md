# üß™ Gu√≠a de Pruebas - Proxyspace Hydra

## ‚úÖ Checklist de Prueba Completa

### 1. Verificar Instalaci√≥n de Dependencias

```bash
cd /Users/sdcarr/Desktop/proxyspace-hydra/hydra
npm install
```

**Resultado esperado:**
- ‚úÖ Dependencias instaladas sin errores
- ‚úÖ `node_modules/` creado
- ‚úÖ `nodemon`, `jest`, `osc`, `ws` presentes

---

### 2. Ejecutar Tests Unitarios

```bash
cd /Users/sdcarr/Desktop/proxyspace-hydra/hydra
npm test
```

**Resultado esperado:**
- ‚úÖ Todos los tests pasan (verde)
- ‚úÖ Coverage report muestra porcentajes
- ‚úÖ `test/osc-client.test.js` y `test/proxy.test.js` ejecutados

**Si fallan tests:** Revisar errores espec√≠ficos, pueden ser falsos positivos por el mock de WebSocket.

---

### 3. Iniciar el Proxy OSC‚ÜîWebSocket

**Opci√≥n A - Con logs de debug (recomendado para primera prueba):**
```bash
cd /Users/sdcarr/Desktop/proxyspace-hydra/hydra
DEBUG=true npm run dev
```

**Opci√≥n B - Modo silencioso (producci√≥n):**
```bash
cd /Users/sdcarr/Desktop/proxyspace-hydra/hydra
npm start
```

**Resultado esperado:**
```
[HH:MM:SS.mmm] [WS] Servidor WebSocket activo en puerto 8080
[HH:MM:SS.mmm] [OSC] Escuchando en 0.0.0.0:57121
[HH:MM:SS.mmm] [OSC] Modo DEBUG activado - todos los mensajes ser√°n logueados
```

**‚ö†Ô∏è Si ves `EADDRINUSE`:**
```bash
# Liberar puertos ocupados
lsof -ti:8080 | xargs kill -9
lsof -ti:57121 | xargs kill -9
```

---

### 4. Iniciar SuperCollider

Abre SuperCollider y ejecuta **`sound2.scd`** paso a paso:

#### 4.1 Configurar ProxySpace y NetAddr
```supercollider
// Ejecutar TODO el bloque de configuraci√≥n inicial
p = ProxySpace.push(s.boot);
p.makeTempoClock;
p.clock = TempoClock.default;

// CR√çTICO: Configurar la direcci√≥n OSC de Hydra
topEnvironment[\hydraAddr] = NetAddr("127.0.0.1", 57121);
```

**Resultado esperado:**
- ‚úÖ SuperCollider inicia servidor de audio
- ‚úÖ ProxySpace configurado
- ‚úÖ `topEnvironment[\hydraAddr]` definido

#### 4.2 Definir el Patr√≥n de Env√≠o OSC
```supercollider
// Ejecutar el Tdef ~osc_ctrl
Tdef(\osc_ctrl, {
  loop {
    var rhythm = (~rhythm.kr(1) ? 0).clip(0, 1);
    var bass = (~bass.kr(1) ? 0).clip(0, 1);
    var high = (~high.kr(1) ? 0).clip(0, 1);

    topEnvironment[\hydraAddr].sendMsg("/sc/rhythm", rhythm);
    topEnvironment[\hydraAddr].sendMsg("/sc/bass", bass);
    topEnvironment[\hydraAddr].sendMsg("/sc/high", high);

    0.05.wait;
  }
});
```

**Resultado esperado:**
- ‚úÖ Tdef definido sin errores

#### 4.3 Definir los Proxies de An√°lisis de Audio
```supercollider
// Ejecutar los proxies ~rhythm, ~bass, ~high
~rhythm = { 
  var sig = SoundIn.ar(0);
  var amp = Amplitude.kr(sig, 0.05, 0.1);
  amp.clip(0, 1);
};

~bass = {
  var sig = SoundIn.ar(0);
  var filtered = LPF.ar(sig, 200);
  var amp = Amplitude.kr(filtered, 0.1, 0.2);
  amp.clip(0, 1);
};

~high = {
  var sig = SoundIn.ar(0);
  var filtered = HPF.ar(sig, 3000);
  var amp = Amplitude.kr(filtered, 0.05, 0.15);
  amp.clip(0, 1);
};
```

**Resultado esperado:**
- ‚úÖ Proxies definidos (`~rhythm`, `~bass`, `~high`)

#### 4.4 Crear el Synth de Audio (Patr√≥n ~a1)
```supercollider
// Ejecutar el Pbind de ~a1
~a1 = Pbind(
  \instrument, \default,
  \degree, Pseq([0, 2, 4, 5, 7], inf),
  \dur, 0.25,
  \amp, 0.3
);
```

**Resultado esperado:**
- ‚úÖ Patr√≥n musical definido

#### 4.5 **INICIAR TODO** (CR√çTICO)
```supercollider
// üö® ESTE ES EL PASO M√ÅS IMPORTANTE üö®
~osc_ctrl.play;  // Inicia el env√≠o OSC
~a1.resume;      // Inicia el patr√≥n musical (Tdef empieza pausado!)
```

**Resultado esperado en la terminal del proxy (si `DEBUG=true`):**
```
[HH:MM:SS.mmm] [OSC] /sc/rhythm -> args=[0.1234] value=0.1234
[HH:MM:SS.mmm] [OSC] /sc/bass -> args=[0.0567] value=0.0567
[HH:MM:SS.mmm] [OSC] /sc/high -> args=[0.0891] value=0.0891
```

**‚ö†Ô∏è Si NO ves mensajes OSC:**
- Verifica `topEnvironment[\hydraAddr]` ‚Üí debe devolver `NetAddr(127.0.0.1, 57121)`
- Aseg√∫rate de haber ejecutado `~osc_ctrl.play`
- **CR√çTICO:** Ejecuta `~a1.resume` (el Tdef inicia pausado)
- Verifica que SuperCollider est√© recibiendo audio (prueba con `{ SoundIn.ar(0) }.play`)

---

### 5. Abrir Hydra en el Navegador

#### 5.1 Iniciar Servidor HTTP
```bash
# En una NUEVA terminal (deja el proxy corriendo en la anterior)
cd /Users/sdcarr/Desktop/proxyspace-hydra
python3 -m http.server 8000
```

**Resultado esperado:**
```
Serving HTTP on :: port 8000 (http://[::]:8000/) ...
```

#### 5.2 Abrir el Template en el Navegador
1. Abre Chrome/Firefox/Safari
2. Navega a: **http://localhost:8000/templates/hydra/layer_mixer_template.html**

**Resultado esperado en el HUD (parte superior izquierda):**
```
Hydra ¬∑ Layer Mixer
Estado: Conectado ‚Üê Debe estar en verde
Ritmo: 0.XXXX   ‚Üê Debe cambiar continuamente
Bajo:  0.XXXX   ‚Üê Debe cambiar continuamente
Agudo: 0.XXXX   ‚Üê Debe cambiar continuamente
Escena: 0 ¬∑ Aurora Boreal
```

**En la consola del navegador (F12):**
```
[OSC] rhythm = 0.1234
[OSC] bass = 0.0567
[OSC] high = 0.0891
```

**‚ö†Ô∏è Si dice "Conectado" pero valores est√°n en 0.1000:**
- SuperCollider NO est√° enviando OSC
- Revisa paso 4.5 (ejecutar `~osc_ctrl.play` y `~a1.resume`)

**‚ö†Ô∏è Si dice "Desconectado" o "Error":**
- El proxy no est√° corriendo en puerto 8080
- Revisa paso 3

---

### 6. Pruebas Interactivas

#### 6.1 Verificar Reactividad Visual
**Con audio reproduci√©ndose en SuperCollider:**
- ‚úÖ Las visuales deben **moverse/cambiar** seg√∫n el ritmo
- ‚úÖ Los n√∫meros en el HUD deben **actualizarse continuamente**
- ‚úÖ El log inferior debe mostrar mensajes OSC llegando

#### 6.2 Cambiar Escenas
**M√©todo 1 - Botones en el navegador:**
- Clic en botones superiores derechos: `0 ¬∑ Aurora Boreal`, `1 ¬∑ Glitch Stream`, `2 ¬∑ Texturas Lentas`
- ‚úÖ Visual debe cambiar inmediatamente
- ‚úÖ Bot√≥n activo debe tener borde dorado

**M√©todo 2 - OSC desde SuperCollider:**
```supercollider
// Enviar cambio de escena manualmente
topEnvironment[\hydraAddr].sendMsg("/sc/scene", 1); // Glitch Stream
topEnvironment[\hydraAddr].sendMsg("/sc/scene", 2); // Texturas Lentas
topEnvironment[\hydraAddr].sendMsg("/sc/scene", 0); // Aurora Boreal
```

#### 6.3 Controlar Par√°metros de Escenas
```supercollider
// Controles espec√≠ficos de Aurora Boreal
topEnvironment[\hydraAddr].sendMsg("/sc/aurora/pulse", 0.8);
topEnvironment[\hydraAddr].sendMsg("/sc/aurora/warp", 0.5);
topEnvironment[\hydraAddr].sendMsg("/sc/aurora/spark", 0.9);
topEnvironment[\hydraAddr].sendMsg("/sc/aurora/contrast", 0.4);

// Controles de Glitch Stream
topEnvironment[\hydraAddr].sendMsg("/sc/glitch/feedback", 0.7);
topEnvironment[\hydraAddr].sendMsg("/sc/glitch/pixelate", 0.6);

// Controles de Texturas Lentas
topEnvironment[\hydraAddr].sendMsg("/sc/textura/grain", 0.5);
topEnvironment[\hydraAddr].sendMsg("/sc/textura/bloom", 0.8);
```

**Resultado esperado:**
- ‚úÖ Las visuales cambian inmediatamente al enviar mensajes
- ‚úÖ Los valores se suavizan (smoothing) progresivamente

---

### 7. Test de Estr√©s / Estabilidad

#### 7.1 Env√≠o R√°pido de Mensajes
```supercollider
// Enviar muchos mensajes r√°pidamente
(
100.do {
  topEnvironment[\hydraAddr].sendMsg("/sc/rhythm", 1.0.rand);
  topEnvironment[\hydraAddr].sendMsg("/sc/bass", 1.0.rand);
  topEnvironment[\hydraAddr].sendMsg("/sc/high", 1.0.rand);
  0.01.wait;
}
)
```

**Resultado esperado:**
- ‚úÖ El proxy no crashea
- ‚úÖ El navegador sigue respondiendo
- ‚úÖ Los valores se actualizan suavemente (smoothing funciona)

#### 7.2 Reconexi√≥n WebSocket
1. En la terminal del proxy, presiona `Ctrl+C` para detenerlo
2. Espera 5 segundos
3. Reinicia el proxy: `npm run dev`

**Resultado esperado:**
- ‚úÖ El navegador detecta desconexi√≥n (Estado: "Desconectado")
- ‚úÖ Al reiniciar el proxy, reconecta autom√°ticamente (Estado: "Conectado")
- ‚úÖ Los valores vuelven a fluir

---

### 8. Performance / Optimizaci√≥n

#### 8.1 Monitor de FPS (en consola del navegador)
```javascript
let frameCount = 0;
let lastTime = performance.now();
setInterval(() => {
  const now = performance.now();
  const fps = (frameCount * 1000) / (now - lastTime);
  console.log(`FPS: ${fps.toFixed(1)}`);
  frameCount = 0;
  lastTime = now;
}, 1000);
```

**Resultado esperado:**
- ‚úÖ FPS > 30 (m√≠nimo aceptable)
- ‚úÖ FPS > 60 (ideal)

**‚ö†Ô∏è Si FPS < 30:**
- Reduce resoluci√≥n del canvas (ver README Troubleshooting)
- Simplifica las escenas (menos capas)

---

## üéØ Resumen de Verificaci√≥n R√°pida

Ejecuta esto para una prueba completa en **5 minutos**:

```bash
# Terminal 1: Proxy con debug
cd osc-proxy && DEBUG=true npm run dev

# Terminal 2: Servidor HTTP
python3 -m http.server 8000
```

**En SuperCollider:**
```supercollider
// Ejecutar TODO de golpe
p = ProxySpace.push(s.boot);
topEnvironment[\hydraAddr] = NetAddr("127.0.0.1", 57121);
Tdef(\osc_ctrl, { /* ... c√≥digo completo ... */ });
~rhythm = { /* ... */ };
~bass = { /* ... */ };
~high = { /* ... */ };
~a1 = Pbind(/* ... */);
~osc_ctrl.play;
~a1.resume;  // ¬°NO OLVIDES ESTO!
```

**En el navegador:**
- Abre: `http://localhost:8000/templates/hydra/layer_mixer_template.html`
- Verifica HUD: `Estado: Conectado` (verde)
- Verifica valores cambiando continuamente
- Prueba botones de escenas

---

## üêõ Troubleshooting R√°pido

| Problema | Soluci√≥n |
|----------|----------|
| `EADDRINUSE` puerto 8080/57121 | `lsof -ti:8080 \| xargs kill -9` |
| "Conectado" pero valores en 0.1000 | Ejecuta `~osc_ctrl.play` y `~a1.resume` en SC |
| No se ve nada visual | Abre consola (F12), busca errores de Hydra |
| Proxy no muestra mensajes OSC | Ejecuta con `DEBUG=true npm run dev` |
| Tests fallan | Normal si es primera vez, revisa mocks |
| FPS bajo | Reduce resoluci√≥n canvas o simplifica escenas |

---

## üìä Criterios de √âxito

‚úÖ **Proyecto funcional** si:
1. Proxy inicia sin errores (puertos 8080, 57121)
2. SuperCollider env√≠a OSC visible en logs del proxy
3. Navegador conecta (HUD muestra "Conectado")
4. Valores num√©ricos cambian continuamente
5. Visuales reaccionan a cambios en valores OSC
6. Cambio de escenas funciona (botones o OSC)
7. FPS > 30 en navegador

---

**¬øListo para producci√≥n?** Ejecuta:
```bash
./setup.sh  # Genera start.sh y stop.sh
./start.sh  # Inicia todo autom√°ticamente
```

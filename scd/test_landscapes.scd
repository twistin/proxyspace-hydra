// =======================================================
// === TEST DE EFECTOS LANDSCAPES (Erosi√≥n Sonora) ===
// =======================================================
(
var addr;
addr = topEnvironment[\hydraAddr] ?? { NetAddr("127.0.0.1", 57122) };
topEnvironment[\testAddr] = addr;
"‚úÖ NetAddr configurado".postln;
)


// Test r√°pido de kick
topEnvironment[\testAddr].sendMsg("/kick");

// Test de erosi√≥n
topEnvironment[\testAddr].sendMsg("/bass_level", 0.6);

// Test de revelaci√≥n
topEnvironment[\testAddr].sendMsg("/melody_note", 0.8);

// Test de ondulaci√≥n
topEnvironment[\testAddr].sendMsg("/texture", 0.5);
// 1. Definir NetAddr FUERA del ProxySpace usando topEnvironment
// IMPORTANTE: No usar ~addr porque estamos en ProxySpace
(
var addr;
addr = topEnvironment[\hydraAddr] ?? { NetAddr("127.0.0.1", 57122) };
topEnvironment[\testAddr] = addr; // Guardar en topEnvironment
"‚úÖ NetAddr configurado: ".post; addr.postln;
)

// 2. Cambiar a escena LANDSCAPES
topEnvironment[\testAddr].sendMsg("/scene", 0); // 0 = LANDSCAPES
"Cambiado a LANDSCAPES".postln;

// =======================================================
// === TESTS INDIVIDUALES ===
// =======================================================

// TEST 1: Kick (cambiar imagen + activar efectos)
(
topEnvironment[\testAddr].sendMsg("/kick");
"‚úÖ KICK enviado - imagen deber√≠a cambiar".postln;1
)

// TEST 2: Bass Level (erosi√≥n + blur)
(
fork {
	10.do { |i|
		var val = i.linlin(0, 9, 0.0, 1.0);
		topEnvironment[\testAddr].sendMsg("/bass_level", val);
		("Bass: " ++ val.round(0.01)).postln;
		0.3.wait;
	};
	"‚úÖ Bass test completado".postln;
};
)

// TEST 3: Melody Note (revelaci√≥n + color)
(
fork {
	10.do { |i|
		var val = i.linlin(0, 9, 0.0, 1.0);
		topEnvironment[\testAddr].sendMsg("/melody_note", val);
		("Melody: " ++ val.round(0.01)).postln;
		0.3.wait;
	};
	"‚úÖ Melody test completado".postln;
};
)

// TEST 4: Texture (wave displacement + feedback)
(
fork {
	10.do { |i|
		var val = i.linlin(0, 9, 0.0, 1.0);
		topEnvironment[\testAddr].sendMsg("/texture", val);
		("Texture: " ++ val.round(0.01)).postln;
		0.3.wait;
	};
	"‚úÖ Texture test completado".postln;
};
)

// =======================================================
// === SECUENCIA COMPLETA DE PRUEBA ===
// =======================================================

(
fork {
	var addr = topEnvironment[\testAddr];
	"üé¨ Iniciando secuencia de prueba LANDSCAPES".postln;

	// Paso 1: Imagen n√≠tida (sin efectos)
	"1. Imagen n√≠tida inicial (5 seg)".postln;
	5.wait;

	// Paso 2: Activar efectos con kick
	"2. KICK - activar efectos".postln;
	addr.sendMsg("/kick");
	2.wait;

	// Paso 3: Erosi√≥n progresiva (bass)
	"3. Erosi√≥n progresiva (bass 0 ‚Üí 0.8)".postln;
	10.do { |i|
		var val = i.linlin(0, 9, 0.0, 0.8);
		addr.sendMsg("/bass_level", val);
		0.4.wait;
	};

	// Paso 4: Revelaci√≥n + color (melody)
	"4. Revelaci√≥n + color (melody 0.3 ‚Üí 1.0)".postln;
	10.do { |i|
		var val = i.linlin(0, 9, 0.3, 1.0);
		addr.sendMsg("/melody_note", val);
		0.4.wait;
	};

	// Paso 5: Ondulaci√≥n (texture)
	"5. Wave displacement (texture 0 ‚Üí 0.7)".postln;
	10.do { |i|
		var val = i.linlin(0, 9, 0.0, 0.7);
		addr.sendMsg("/texture", val);
		0.4.wait;
	};

	// Paso 6: Combinar todo
	"6. Combinaci√≥n (3 seg)".postln;
	addr.sendMsg("/bass_level", 0.6);
	addr.sendMsg("/melody_note", 0.8);
	addr.sendMsg("/texture", 0.5);
	3.wait;

	// Paso 7: Decay (dejar que se desvanezca)
	"7. Decay autom√°tico (5 seg)".postln;
	addr.sendMsg("/bass_level", 0.0);
	addr.sendMsg("/melody_note", 0.3);
	addr.sendMsg("/texture", 0.0);
	5.wait;

	"‚úÖ Secuencia completa finalizada".postln;
};
)

// =======================================================
// === STOP DE EMERGENCIA ===
// =======================================================

// Detener todo y resetear valores
(
var addr = topEnvironment[\testAddr];
addr.sendMsg("/bass_level", 0.0);
addr.sendMsg("/melody_note", 0.5);
addr.sendMsg("/texture", 0.0);
"‚õî Reset enviado".postln;
)

// =======================================================
// === PATRONES CONTINUOS PARA LIVE CODING ===
// =======================================================

// Patr√≥n 1: Erosi√≥n pulsante
(
var addr = topEnvironment[\testAddr];
Pdef(\erosionPulse,
	Pbind(
		\type, \osc,
		\addr, addr,
		\oscPath, "/bass_level",
		\val, Pseq([0.2, 0.6, 0.8, 0.4], inf),
		\dur, 4
	)
).play;
)

Pdef(\erosionPulse).stop;

// Patr√≥n 2: Revelaci√≥n c√≠clica
(
var addr = topEnvironment[\testAddr];
Pdef(\revealCycle,
	Pbind(
		\type, \osc,
		\addr, addr,
		\oscPath, "/melody_note",
		\val, Pwhite(0.3, 1.0),
		\dur, Pwhite(2, 6)
	)
).play;
)

Pdef(\revealCycle).stop;

// Patr√≥n 3: Ondulaci√≥n aleatoria
(
var addr = topEnvironment[\testAddr];
Pdef(\waveRandom,
	Pbind(
		\type, \osc,
		\addr, addr,
		\oscPath, "/texture",
		\val, Pwhite(0.0, 0.7),
		\dur, Pwhite(1, 4)
	)
).play;
)

Pdef(\waveRandom).stop;

// Patr√≥n 4: Kicks peri√≥dicos
(
var addr = topEnvironment[\testAddr];
Pdef(\kickPattern,
	Pbind(
		\type, \osc,
		\addr, addr,
		\oscPath, "/kick",
		\dur, 8 // Cada 8 beats = cambio de imagen
	)
).play;
)

Pdef(\kickPattern).stop;

// DETENER TODOS LOS PATRONES
Pdef.all.do(_.stop);
